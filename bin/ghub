#!/bin/bash
function abspath {
  if [[ -d "$1" ]]
  then
    pushd "$1" >/dev/null
    pwd
    popd >/dev/null
  elif [[ -e "$1" ]]
  then
    pushd "$(dirname "$1")" >/dev/null
    echo "$(pwd)/$(basename "$1")"
    popd >/dev/null
  fi
}

target=$(abspath $1)
echo "file: $target"
if [[ -z $target ]]; then
  echo "please pass a file or path"
  exit 1
fi
root_dir=$(git rev-parse --show-toplevel)
relative_dir="${target/${root_dir}/}"
IFS=":" read -ra PARTS <<< "$(git remote get-url origin)"
open "https://${PARTS[0]/git@/}/${PARTS[1]/.git/}/tree/$(git rev-parse --abbrev-ref HEAD)/$relative_dir"
